# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

## Ответ

Понял, извините за недоразумение. Давайте теперь рассмотрим конкретные продукты для каждого пункта и обоснуем их выбор, исходя из заданных критериев:

1. Облачная система: AWS (Amazon Web Services)

   - Обоснование: AWS предлагает широкий спектр облачных услуг, включая хостинг, хранение данных, вычислительные ресурсы и другие. AWS предоставляет множество инструментов для разработки и эксплуатации микросервисов, включая системы контроля версий, контейнерные сервисы, а также возможности непрерывной интеграции и доставки. Более того, AWS предлагает бесплатные уровни использования для некоторых услуг, что делает его доступным для начала работы с минимальными затратами.

2. Система контроля версий Git: GitLab

   - Обоснование: GitLab является полноценной платформой, которая объединяет в себе возможности системы контроля версий Git, непрерывной интеграции и непрерывной поставки. Он предоставляет широкие возможности для хранения и управления исходным кодом, создания пайплайнов CI/CD, настройки автоматических сборок и развертывания. GitLab Community Edition доступен бесплатно и имеет активное сообщество, что делает его привлекательным вариантом для начинающих команд.

3. Репозиторий на каждый сервис: GitLab

   - Обоснование: GitLab позволяет создавать неограниченное количество репозиториев, что позволяет выделять отдельный репозиторий для каждого микросервиса. Такой подход обеспечивает независимость и удобство управления кодом каждого сервиса.

4. CI/CD инструмент: GitLab CI/CD

   - Обоснование: GitLab CI/CD является интегрированным инструментом в составе GitLab, который обладает широкими возможностями для настройки непрерывной интеграции и доставки. Он позволяет создавать пайплайны, включающие шаги сборки, тестирования и развертывания приложений. Использование GitLab CI/CD вместе с GitLab репозиторием позволяет покрыть несколько пунктов изначальной задачи одним продуктом, что обеспечивает интеграцию и согласованность работы между ними.

5. Система управления секретами: HashiCorp Vault

   - Обоснование: HashiCorp Vault предоставляет централизованное и безопасное хранение секретных данных, таких как пароли, ключи доступа и другие конфиденциальные материалы. Он обладает мощными возможностями управления доступом и шифрования данных. Vault интегрируется с различными инструментами и позволяет безопасно передавать секреты в процессе сборки и развертывания.

6. Кастомные шаги при сборке: Jenkins

   - Обоснование: Jenkins является гибким и расширяемым инструментом, который позволяет настраивать сложные и индивидуальные пайплайны с помощью кастомных шагов. Он предоставляет широкий набор плагинов и интеграций, что делает его подходящим выбором для настройки и автоматизации различных этапов сборки и тестирования.

7. Собственные докер-образы для сборки проектов: Docker

   - Обоснование: Docker является популярной технологией контейнеризации, которая позволяет создавать и управлять изолированными контейнерами для приложений и сервисов. Использование Docker образов для сборки проектов обеспечивает повторяемость и переносимость среды, что упрощает развертывание и обеспечивает консистентность процесса сборки.

8. Развертывание агентов сборки на собственных серверах: Jenkins

   - Обоснование: Jenkins предоставляет возможность развертывания агентов сборки на собственных серверах или виртуальных машинах. Это позволяет более эффективно управлять ресурсами и настраивать окружение согласно требованиям проекта.

9. Параллельный запуск нескольких сборок: Jenkins

   - Обоснование: Jenkins позволяет настраивать параллельный запуск нескольких сборок, что повышает эффективность процесса разработки и сокращает время выполнения задач. Это особенно полезно в микросервисной архитектуре, где может быть необходимо одновременное выполнение сборок для разных сервисов.

10. Параллельный запуск тестов: CircleCI

    - Обоснование: CircleCI поддерживает параллельный запуск тестов, что позволяет распределить нагрузку и сократить время выполнения тестового набора. Он также обладает простым и интуитивным интерфейсом, что упрощает настройку и поддержку.

Основными критериями выбора были:

- Охват одним решением нескольких задач
- Преимущественная бесплатность и открытый исходный код
- Активное сообщество, обеспечивающее более легкую поддержку и обслуживание

Учитывая выбранные критерии, представленный набор продуктов позволит охватить большую часть требований, быть доступным по стоимости и обладать широкой поддержкой со стороны сообщества. Однако, важно отметить, что конкретный выбор инструментов зависит от особенностей проекта, существующей инфраструктуры и предпочтений команды разработки.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

## Ответ

Для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре, предлагаю следующее решение, удовлетворяющее требованиям:

1. Центральное хранилище логов: Elasticsearch и Logstash (ELK стек)

   - Обоснование: ELK стек состоит из Elasticsearch, Logstash и Kibana. Elasticsearch предоставляет масштабируемое и распределенное хранилище для логов, которое обеспечивает быстрый поиск и анализ данных. Logstash предназначен для сбора, обработки и перенаправления логов в Elasticsearch. Совместное использование Elasticsearch и Logstash позволяет собирать логи из различных источников в центральное хранилище и обеспечивает гарантированную доставку логов.

2. Сбор логов из stdout: Filebeat

   - Обоснование: Filebeat является легковесным агентом, который собирает и пересылает логи с хостов в центральное хранилище. Filebeat может быть настроен для мониторинга stdout приложений и перенаправления логов в Logstash или Elasticsearch. Это позволяет собирать логи из различных сервисов, используя минимальные требования к изменению самих приложений.

3. Инструменты поиска и анализа логов: Kibana

   - Обоснование: Kibana предоставляет графический интерфейс для поиска, фильтрации и анализа логов, хранящихся в Elasticsearch. Он позволяет разработчикам и операторам осуществлять поиск по записям логов, фильтровать данные, создавать визуализации и дашборды для мониторинга. Kibana также предоставляет возможность сохранения поисковых запросов в виде ссылок, что упрощает обмен и совместную работу с другими членами команды.

Вместе ELK стек и Filebeat предоставляют решение, которое позволяет собирать, хранить и анализировать логи из различных сервисов в микросервисной архитектуре. Это решение обладает высокой масштабируемостью, гибкостью и удовлетворяет всем поставленным требованиям, включая централизованное хранение, гарантированную доставку, поиск, фильтрацию и пользовательский интерфейс для разработчиков.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

## Ответ

Предложение решения для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре:

1. Сбор и хранение метрик: **Prometheus**
   - Обоснование: Prometheus является мощным инструментом для сбора и хранения метрик. Он позволяет собирать метрики со всех хостов и сервисов в системе, включая метрики состояния ресурсов хостов (CPU, RAM, HDD, Network) и метрики потребляемых ресурсов для каждого сервиса. Prometheus обеспечивает масштабируемое хранение данных и гибкие возможности запросов для анализа и агрегации информации.

2. Визуализация и пользовательский интерфейс: **Grafana**
   - Обоснование: Grafana предоставляет мощный пользовательский интерфейс для визуализации и анализа метрик, собранных Prometheus. Он позволяет создавать настраиваемые панели для отслеживания состояния системы, агрегировать информацию и создавать пользовательские запросы. Grafana обладает широким набором графических инструментов и возможностей настройки, что позволяет разработчикам и операторам адаптировать интерфейс под свои потребности.

3. Сбор специфичных метрик сервисов: Встроенные инструменты и библиотеки
   - Обоснование: Для сбора специфичных метрик, которые требуются для каждого сервиса, рекомендуется использовать встроенные инструменты и библиотеки внутри каждого сервиса. Например, для приложений на базе Node.js можно использовать библиотеку Prometheus client, а для приложений на базе Java - Micrometer. Эти инструменты позволяют экспортировать специфичные метрики сервисов в формате, понятном Prometheus.

Решение с использованием Prometheus и Grafana обеспечивает мощный инструментарий для сбора, хранения и визуализации метрик в микросервисной архитектуре. Оно позволяет собирать и анализировать метрики состояния хостов, потребляемых ресурсов сервисов и специфичных метрик, предоставляя гибкий пользовательский интерфейс для запросов и настройки панелей мониторинга.
