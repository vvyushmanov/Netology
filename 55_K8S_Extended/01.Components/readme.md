# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----

### Правила приёма работы

1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Сначала сделайте расчёт всех необходимых ресурсов.
3. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
4. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
5. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
6. В результате должно быть указано количество нод и их параметры.

### Ответ

Для выполнения задания, необходимо рассчитать требуемые ресурсы для каждого компонента и определить количество рабочих нод, способных обеспечить такую нагрузку. Также учтем дополнительные ресурсы для обеспечения отказоустойчивости и служебные ресурсы.

1. Расчет ресурсов для базы данных:

- ОЗУ: 4 ГБ * 3 копии = 12 ГБ
- CPU: 1 ядро * 3 копии = 3 ядра

2. Расчет ресурсов для системы кеширования:

- ОЗУ: 4 ГБ * 3 копии = 12 ГБ
- CPU: 1 ядро * 3 копии = 3 ядра

3. Расчет ресурсов для фронтенда:

- ОЗУ: 50 МБ * 5 копий = 250 МБ
- CPU: 0.2 ядра * 5 копий = 1 ядро

4. Расчет ресурсов для бекенда:

- ОЗУ: 600 МБ * 10 копий = 6000 МБ (или 6 ГБ)
- CPU: 1 ядро * 10 копий = 10 ядер

Теперь у нас есть общий расчет ресурсов:

- ОЗУ: 12 ГБ (База данных) + 12 ГБ (Система кеширования) + 6 ГБ (Фронтенд) = 30 ГБ
- CPU: 3 ядра (База данных) + 3 ядра (Система кеширования) + 1 ядро (Фронтенд) + 10 ядер (Бекенд) = 17 ядер

Теперь добавим запас для обеспечения отказоустойчивости, например, 20% от общего ресурса:

- ОЗУ: 30 ГБ + 20% = 36 ГБ
- CPU: 17 ядер + 20% = 21 ядро

Для оценки количества нод в кластере Kubernetes с учетом расчетов, нужно сначала определить требуемые ресурсы для каждой среды и затем добавить мастер-ноды.

1. Ресурсы для каждой среды: Для каждой среды (дев, тест и прод) нужно 36 ГБ ОЗУ и 21 ядро CPU. Таким образом, общие ресурсы для всех сред будут:

    - ОЗУ: 36 ГБ * 3 = 108 ГБ
    - CPU: 21 ядро * 3 = 63 ядра

2. Мастер-ноды: Обычно для обеспечения отказоустойчивости рекомендуется использовать не менее трех мастер-нод.

Теперь определимся с ресурсами для мастер-нод. Мастер-ноды обычно не требуют таких больших ресурсов, как рабочие ноды (где запускаются приложения). Обычно хватает небольшого объема ОЗУ и процессорной мощности. Предположим, что для каждой мастер-ноды требуется 4 ГБ ОЗУ и 2 ядра CPU. Тогда общие ресурсы для всех мастер-нод будут:

- ОЗУ: 4 ГБ * 3 = 12 ГБ
- CPU: 2 ядра * 3 = 6 ядер

Теперь можем подсчитать общие ресурсы для кластера:

- Общее ОЗУ: 108 ГБ (рабочие ноды) + 12 ГБ (мастер-ноды) = 120 ГБ
- Общее CPU: 63 ядра (рабочие ноды) + 6 ядер (мастер-ноды) = 69 ядер

Теперь выберем размеры нод: Когда выбираете размеры нод, стоит руководствоваться тем, чтобы было не менее 2-х нод для отказоустойчивости, поскольку если одна нода выйдет из строя, приложения будут продолжать работать на другой.

Например, допустим у нас есть рабочие ноды с ресурсами:

- ОЗУ: 8 ГБ
- CPU: 8 ядер

И мастер ноды с ресурсами:

- ОЗУ: 4 ГБ
- ЦПУ: 2 ядра

Тогда мы можем использовать следующую конфигурацию:

- Рабочие ноды: 8 нод
- Мастер-ноды:  3 ноды
- Всего нод в кластере: 11 нод
