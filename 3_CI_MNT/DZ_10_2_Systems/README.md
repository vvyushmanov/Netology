# Домашнее задание к занятию "13.Системы мониторинга"

## Обязательные задания
### Вопрос 1.

Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы
выведите в мониторинг и почему?

### Ответ:

1. `CPU utilization:` Мониторинг загрузки ЦПУ позволит отслеживать нагрузку на серверы, занимаемые приложениями и процессами, и выявлять возможные проблемы в работе системы, связанные с недостаточностью вычислительных ресурсов.

2. `Memory utilization:` Этот параметр поможет отследить использование оперативной памяти серверов. Это может быть полезно для выявления утечек памяти, которые могут привести к нехватке памяти и сбоям в работе системы.

3. `Network traffic:` Мониторинг сетевого трафика позволит отслеживать количество передаваемых данных и определять, не возникают ли проблемы с пропускной способностью сети или с настройками маршрутизаторов.

4. `HTTP response time:` Этот параметр поможет отслеживать время ответа сервера на запросы HTTP. Это может быть полезно для выявления проблем с производительностью приложения или с сетью.

5. `Disk space utilization:` Этот параметр поможет отследить использование дискового пространства на серверах и предотвратить возможные проблемы с недостаточностью места на диске для сохранения отчетов.

6. `IOPS (Input/Output Operations Per Second):` Мониторинг метрики IOPS позволит отслеживать нагрузку на дисковую подсистему, определять потенциальные узкие места в производительности дисков и выявлять возможные проблемы с хранением данных. В результате этого можно принимать меры для улучшения производительности и отказоустойчивости системы, такие как изменение конфигурации дисковой подсистемы, распределение нагрузки на диски или замена устаревших дисков.

### Вопрос 2.

Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

### Ответ:

- Метрика RAM показывает, сколько оперативной памяти используется в данный момент, и позволяет оценить, насколько эффективно используется память, а также выявить возможные утечки памяти, которые могут привести к сбоям системы.

- Метрика inodes показывает, сколько файловых структур уже создано на файловой системе и сколько еще может быть создано. Эта метрика помогает оценить заполненность файловой системы и прогнозировать, когда может произойти ее заполнение.

- CPUla (CPU Load Average) - это метрика, которая показывает, насколько загружен процессор в системе. Она представляет собой среднее значение загрузки процессора за определенный период времени (обычно за последние 1, 5 и 15 минут). Метрика CPUla позволяет оценить, насколько процессор занят работой и может ли он обрабатывать новые задачи. Если загрузка процессора слишком высока, это может означать, что система работает медленно или может столкнуться с проблемами производительности.

Для понимания текущего качества обслуживания и степени выполнения обязаностей перед клинетами, можно использовать следующие метрики:

- `SLO (Service Level Objective)` - это метрика, которая определяет уровень производительности, который нужен для обеспечения удовлетворительного уровня обслуживания. Она часто используется в контексте SLA и может включать множество показателей производительности, таких как время ответа, доступность и другие.

- `SLA (Service Level Agreement)` - это документ, в котором описываются обязательства по уровню обслуживания, которые бизнес-организация предоставляет своим клиентам или внутренним пользователям. SLA часто включает в себя SLO и описывает условия, которые будут выполнены при достижении этого уровня производительности. SLA определяет периодичность проверки и отчетности по SLO.

- `SLI (Service Level Indicator)` - это метрика, которая измеряет и отслеживает производительность системы. SLI обычно измеряет производительность по одному конкретному аспекту, например, доступности или времени ответа. Она является основой для определения SLO и помогает команде IT и менеджменту понимать текущий уровень производительности системы и мониторить ее изменение.

### Вопрос 3.

Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

### Ответ:

1. Лучшим решением будет использовать `Sentry`. Sentry предоставляет возможности по сбору, агрегации, хранению и анализу данных об ошибках и предупреждениях, а также инструменты для быстрого и удобного решения проблем. Sentry может быть использован в качестве инструмента для сбора логов в приложении. Он позволяет получать информацию об ошибках и событиях в приложении, включая информацию о стеке вызовов, параметрах запроса, окружении и других полезных данных, которые помогут разработчикам быстро выявлять и исправлять проблемы.

2. Если такого решения недостатотчно, можно использовать `ELK стек` для сбора логов, генерируемых приложениями. Его компоненты Logstash, Elasticsearch и Kibana позволяют собирать, анализировать и визуализировать логи, а также получать оповещения об ошибках через механизмы мониторинга. Под эту же категорию попадают такие системы, как Graylog и Grafana Loki.

### Вопрос 4.

Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. 
Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

### Ответ:

- Ошибка в том, что не учтены 3хх коды ответа, которые не являются ошибочными. Таким образом, правильная формула будет выглядеть так:

`SLI = (summ_2xx_requests + summ_3xx_requests) / (summ_all_requests)`

### Вопрос 5.

Опишите основные плюсы и минусы pull и push систем мониторинга.

### Ответ:

`Push-мониторинг` - вид мониторинга, при котором источник метрик самостоятельно отправляет данные на мониторинговую систему. Такой подход используется, например, в случае с системами мониторинга событий и журналов, где данные создаются и записываются на локальном устройстве. Плюсы push-мониторинга заключаются в том, что он позволяет получать данные мгновенно и непрерывно, что особенно важно в случае событийного мониторинга. Однако, в некоторых случаях push-мониторинг может потреблять больше ресурсов и приводить к перегрузке сети.

`Pull-мониторинг` - это когда мониторинговая система запросом запрашивает данные у источника метрик. Этот подход используется, например, в случае мониторинга состояния системы и сбора метрик на удаленных устройствах. Основным преимуществом pull-мониторинга является то, что он не перегружает сеть и не использует ресурсы, пока данные не запрошены. Однако, pull-мониторинг может не успевать за изменениями в системе и не давать актуальной информации.

### Вопрос 6.

Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

    - Prometheus 
    - TICK
    - Zabbix
    - VictoriaMetrics
    - Nagios

### Ответ

Push: Zabbix, VictoriaMetrics, TICK

Pull: Zabbix, VictoriaMetrics, Prometheus, Nagios

Некоторые системы мониторинга могут использовать гибридную модель, в которой часть данных передается в push-стиле, а другая часть извлекается путем опроса (pull) устройств и систем. Например, `Zabbix` и `VictoriaMetrics` также поддерживает pull-модель, которая позволяет получать метрики от конечных точек, которые не могут отправлять метрики push-стилем.


### Задание 7-9

Склонируйте себе [репозиторий](https://github.com/influxdata/sandbox/tree/master) и запустите TICK-стэк, используя технологии docker и docker-compose.
В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (`http://localhost:8888`).

### Ответ:

![Alt text](img/1.%20TICK.png)


Перейдите в веб-интерфейс Chronograf (`http://localhost:8888`) и откройте вкладку `Data explorer`.

    - Нажмите на кнопку `Add a query`
    - Изучите вывод интерфейса и выберите БД `telegraf.autogen`
    - В `measurments` выберите mem->host->telegraf_container_id , а в `fields` выберите used_percent. 
    Внизу появится график утилизации оперативной памяти в контейнере telegraf.
    - Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. 
    Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.

Для выполнения задания приведите скриншот с отображением метрик утилизации места на диске 
(disk->host->telegraf_container_id) из веб-интерфейса.

![Alt text](img/2.%20Disk.png)

Изучите список [telegraf inputs](https://github.com/influxdata/telegraf/tree/master/plugins/inputs). 
Добавьте в конфигурацию telegraf следующий плагин - [docker](https://github.com/influxdata/telegraf/tree/master/plugins/inputs/docker):
```
[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
```

После настройки перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список `measurments` в веб-интерфейсе базы telegraf.autogen. Там должны появиться метрики, связанные с docker.

![Alt text](img/3.%20Docker.png)
